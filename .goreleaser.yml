version: 2

builds:
  - id: dzsa-sync
    env:
      - CGO_ENABLED=0
    mod_timestamp: '{{ .CommitTimestamp }}'
    main: ./cmd/dzsasync/
    goos:
      - linux
    goarch:
      - amd64
      - arm64
    binary: dzsa-sync
    flags:
      - -v
      - -trimpath

nfpms:
  - id: dzsa-sync
    package_name: dzsa-sync
    builds:
      - dzsa-sync
    file_name_template: '{{ .PackageName }}-{{ .Arch }}'
    homepage: https://github.com/jsirianni/dzsa-sync
    description: Register DayZ servers with dayzsalauncher.com
    formats:
      - deb
      - rpm
    bindir: /usr/bin
    contents:
      - dst: /etc/dzsa-sync
        type: dir
        file_info:
          owner: dzsa-sync
          group: dzsa-sync
          mode: 0750
      - dst: /var/log/dzsa-sync
        type: dir
        file_info:
          owner: dzsa-sync
          group: dzsa-sync
          mode: 0750
      - src: package/config.yaml
        dst: /etc/dzsa-sync/config.yaml
        type: "config"
        file_info:
          owner: dzsa-sync
          group: dzsa-sync
          mode: 0640
      - src: package/dzsa-sync.service
        dst: /usr/lib/systemd/system/dzsa-sync.service
        type: "config"
        file_info:
          owner: root
          group: root
          mode: 0640
    scripts:
      preremove: "./package/scripts/preremove.sh"
      postremove: "./package/scripts/postremove.sh"
      preinstall: "./package/scripts/preinstall.sh"
      postinstall: "./package/scripts/postinstall.sh"

archives:
  - format: binary

release:
  draft: false
  prerelease: false
